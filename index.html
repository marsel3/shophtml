<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: white;
  }

  .container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    max-width: 390px;
    margin: 0 auto;
    padding: 20px;
  }

  .item {
    width: calc(50% - 10px);
    margin-bottom: 20px;
    border: 1px solid #ccc;
    padding: 10px;
    box-sizing: border-box;
    position: relative; /* Added for positioning */
  }

  .item img {
    max-width: 100%;
    height: auto;
  }

  .item h3 {
    margin: 10px 0;
    font-size: 16px;
  }

  .item p {
    margin: 5px 0;
    font-size: 14px;
  }

  .item .buy-button {
    display: block;
    width: 100%;
    text-align: center;
    padding: 5px;
    background-color: #007bff;
    color: #fff;
    cursor: pointer;
    border: none;
    border-radius: 10px;
  }

  .buy-button:hover {
    background-color: #00c4ff;
  }

  .item .quantity-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  /* Стили для кнопок + и - */
  .plus-button,
  .minus-button {
    background-color: #007bff;
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    font-size: 16px;
    cursor: pointer;
  }

  .plus-button:hover,
  .minus-button:hover {
    background-color: #00c4ff;
  }

  .quantity-display {
    font-size: 16px;
    margin: 0 10px;
  }
  .quantity-input {
    width: 40px;
    padding: 5px;
    text-align: center;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 14px;
  }

  .quantity-input {
    width: 40px;
    padding: 5px;
    text-align: center;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 14px;
  }

  .checkout-button {
    display: block;
    margin: 20px auto;
    padding: 10px 20px;
    background-color: #ff0000;
    color: #fff;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    cursor: pointer;
  }

  .checkout-button:hover {
    background-color: #cc0000;
  }
</style>
<title>Мобильный магазин</title>
</head>
<body>
  <div class="container">
    <div class="item" id="product1">
      <img src="1.jpg" alt="Товар 1">
      <h3>Товар 1</h3>
      <p>Цена: $10</p>
      <div class="quantity-controls" style="display: none;">
        <button class="minus-button">-</button>
        <input type="number" class="quantity-input" value="0" min="0">
        <button class="plus-button">+</button>
      </div>
      <button class="buy-button">Купить</button>
    </div>

    <div class="item" id="product2">
      <img src="1.jpg" alt="Товар 2">
      <h3>Товар 2</h3>
      <p>Цена: $10</p>
      <div class="quantity-controls" style="display: none;">
        <button class="minus-button">-</button>
        <input type="number" class="quantity-input" value="0" min="0">
        <button class="plus-button">+</button>
      </div>
      <button class="buy-button">Купить</button>
    </div>

    <div class="item" id="product3">
      <img src="1.jpg" alt="Товар 3">
      <h3>Товар 3</h3>
      <p>Цена: $17</p>
      <div class="quantity-controls" style="display: none;">
        <button class="minus-button">-</button>
        <input type="number" class="quantity-input" value="0" min="0">
        <button class="plus-button">+</button>
      </div>
      <button class="buy-button">Купить</button>
    </div>

        <div class="item" id="product4">
      <img src="1.jpg" alt="Товар 4">
      <h3>Товар 4</h3>
      <p>Цена: $10</p>
      <div class="quantity-controls" style="display: none;">
        <button class="minus-button">-</button>
        <input type="number" class="quantity-input" value="0" min="0">
        <button class="plus-button">+</button>
      </div>
      <button class="buy-button">Купить</button>
    </div>

    <div class="item" id="product5">
      <img src="1.jpg" alt="Товар 5">
      <h3>Товар 5</h3>
      <p>Цена: $4</p>
      <div class="quantity-controls" style="display: none;">
        <button class="minus-button">-</button>
        <input type="number" class="quantity-input" value="0" min="0">
        <button class="plus-button">+</button>
      </div>
      <button class="buy-button">Купить</button>
    </div>

    <div class="item" id="product6">
      <img src="1.jpg" alt="Товар 6">
      <h3>Товар 6</h3>
      <p>Цена: $17</p>
      <div class="quantity-controls" style="display: none;">
        <button class="minus-button">-</button>
        <input type="number" class="quantity-input" value="0" min="0">
        <button class="plus-button">+</button>
      </div>
      <button class="buy-button">Купить</button>
    </div>


    <button class="checkout-button" id="checkout-button">Оформить заказ</button>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    let tg = window.Telegram.WebApp; //получаем объект webapp телеграма
    tg.expand(); //расширяем на все окно

    const checkoutButton = document.getElementById('checkout-button');
    const items = document.querySelectorAll('.item');
  const cart = {}; // Объект для хранения состава корзины

    items.forEach(item => {
    const buyButton = item.querySelector('.buy-button');
    const plusButton = item.querySelector('.plus-button');
    const minusButton = item.querySelector('.minus-button');
    const quantityInput = item.querySelector('.quantity-input');
    const quantityControls = item.querySelector('.quantity-controls');
    const itemId = item.id;
    const itemName = item.querySelector('h3').innerText;

    let quantity = 0;


      plusButton.addEventListener('click', () => {
        quantity++;
        quantityInput.value = quantity;
        updateButtonsVisibility();
      });

      minusButton.addEventListener('click', () => {
        if (quantity > 0) {
          quantity--;
          quantityInput.value = quantity;
          updateButtonsVisibility();
        }
      });

      buyButton.addEventListener('click', () => {
        quantity = 1;
        quantityInput.value = quantity;
        updateButtonsVisibility();
      });

      quantityInput.addEventListener('input', () => {
        quantity = parseInt(quantityInput.value) || 0;
        updateButtonsVisibility();
      });

    const updateButtonsVisibility = () => {
      if (quantity > 0) {
        buyButton.style.display = 'none';
        quantityControls.style.display = 'flex';
        cart[itemId] = {
          name: itemName,
          quantity: quantity,
        };
      } else {
        buyButton.style.display = 'inline';
        quantityControls.style.display = 'none';
        delete cart[itemId];
      }
    };
    updateButtonsVisibility();
  });

  checkoutButton.addEventListener('click', () => {
    const cartItems = [];

    // Перебираем товары в корзине и добавляем информацию о каждом товаре
    for (const productId in cart) {
      const product = cart[productId];
      cartItems.push({
        id: productId,
        name: product.name,
        quantity: product.quantity,
      });
    }

    // Отправляем информацию о корзине через Telegram
    const data = {
      cart: cartItems,
    };
    alert('Пшёл от сюда! Ещё раз увижу тебя тут, миллион вирусов в телефон закину!')
    tg.sendData(JSON.stringify(data));
    tg.close();
  });
  </script>
</body>
</html>
